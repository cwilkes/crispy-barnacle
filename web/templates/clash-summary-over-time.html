<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
  <!--<script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>-->
  <script src="http://d3js.org/d3.v3.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.1.6.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <head>
    <title>Clashes over time</title>
  </head>
  <body>

<p id="description">
  High-level, day-over-day clashes over time.
</p>

<select id="grouping">
</select>
<div id="plot">
</div>


<script type="text/javascript">
  var svg = dimple.newSvg("#plot", 800, 600);

  function replot(data) {
    svg.selectAll('*').remove();
    var grouping = $('#grouping').val();
    console.log(grouping);
    var myChart = new dimple.chart(svg, data);
    var x = myChart.addTimeAxis("x", "date", "%Y-%m-%d","%Y-%m-%d");
    var y = myChart.addMeasureAxis("y", "n_clashes");
    var series = myChart.addSeries('group', dimple.plot.bubble, [x, y]);
    series.data = data[grouping];


    myChart.addLegend(60, 10, 500, 20, "right");
    myChart.draw();
  }

  $.getJSON('test-data.json', function(response){
      var data = response;
      $.each(data, function(key, value) {   
        $('#grouping')
        .append($('<option>', { key : key })
          .text(key)); 
      });
      replot(data);
      
      var mySelect = document.getElementById("grouping");
      mySelect.addEventListener('change', function () {replot(data)});
  });
</script>
